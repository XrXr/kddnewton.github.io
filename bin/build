#!/usr/bin/env ruby
# frozen_string_literal: true

require 'erb'
require 'fileutils'
require 'kramdown'
require 'yui/compressor'

asset_dir = File.expand_path(File.join('..', 'assets'), __dir__)
build_dir = File.expand_path(File.join('..', 'build'), __dir__)
src_dir = File.expand_path(File.join('..', 'src'), __dir__)

body = Kramdown::Document.new(File.read(File.join(src_dir, 'index.md'))).to_html
result = ERB.new(File.read(File.join(src_dir, 'template.html'))).result(binding)

File.write(File.join(build_dir, 'index.html'), result)

Dir[File.join(asset_dir, '*')].each do |source|
  dest = File.join(build_dir, 'assets', File.basename(source))

  if source.end_with?('.css')
    compressor = YUI::CssCompressor.new
    File.write(dest, compressor.compress(File.read(source)))
  else
    FileUtils.cp(source, dest)
  end
end

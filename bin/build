#!/usr/bin/env ruby
# frozen_string_literal: true

require 'date'
require 'erb'
require 'fileutils'
require 'kramdown'

def read(name)
  path = File.join('src', "#{name}.md")
  Kramdown::Document.new(File.read(path)).to_html
end

Dir.chdir(File.expand_path('..', __dir__)) do
  template = File.read(File.join('src', 'template.html'))

  File.write(
    'index.html',
    ERB.new(template).result_with_hash(
      projects: read('projects'),
      speaking: read('speaking'),
      posts: read('posts')
    )
  )

  File.write('sitemap.xml', <<~SITEMAP)
    <?xml version="1.0" encoding="UTF-8"?>
    <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
       <url>
          <loc>https://kevindeisz.com/</loc>
          <lastmod>#{Date.today}</lastmod>
          <changefreq>monthly</changefreq>
          <priority>1</priority>
       </url>
    </urlset>
  SITEMAP
end
